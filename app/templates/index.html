{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">Welcome to Dynamic Price Tracker</h1>
<form method="post" action="{{ url_for('main.track') }}" class="card p-3 shadow-sm">
  <div class="mb-3">
    <label class="form-label">Paste your product URL</label>
    <input type="url" name="url" class="form-control" placeholder="https://www.flipkart.com/..." required>
  </div>
  <div class="mb-3">
    <label class="form-label">Target Price (₹)</label>
    <input type="number" step="0.01" name="target" class="form-control" placeholder="e.g., 1499">
  </div>
  <button class="btn btn-primary">Track</button>
</form>

<hr>
<h4 class="mt-4">Tracked Products</h4>
<table class="table table-sm align-middle">
  <thead>
    <tr><th>ID</th><th>Title</th><th>Site</th><th>Last Price</th><th>Updated</th><th></th></tr>
  </thead>
  <tbody>
  {% for p in products %}
    <tr>
      <td>{{ p.product_id }}</td>
      <td class="text-truncate" style="max-width: 420px;">{{ p.title }}</td>
      <td>{{ p.site }}</td>
      <td>₹{{ '%.2f'|format(p.last_seen_price|float) }}</td>
      <td>{{ p.updated_at }}</td>
      <td><a class="btn btn-outline-secondary btn-sm" href="{{ url_for('main.history_item', product_id=p.product_id) }}">View</a></td>
    </tr>
  {% else %}
    <tr><td colspan="6" class="text-muted">No products tracked yet.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}