{% extends "base.html" %}
{% block content %}
<h2>Price History</h2>
<div class="row g-4">
  <div class="col-md-4">
    <div class="card p-3 h-100">
      <h6>Choose a product</h6>
      <ul class="list-group list-group-flush">
        {% for p in products %}
          <li class="list-group-item d-flex justify-content-between align-items-center {% if selected==p.product_id %}active{% endif %}">
            <a class="stretched-link {% if selected==p.product_id %}text-white{% endif %}" href="{{ url_for('main.history_item', product_id=p.product_id) }}">#{{ p.product_id }} — {{ p.title[:45] }}{% if p.title|length>45 %}…{% endif %}</a>
          </li>
        {% else %}
          <li class="list-group-item text-muted">No products yet.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="col-md-8">
    {% if history %}
    <div class="card p-3">
      <canvas id="priceChart" height="120"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById('priceChart');
      const labels = {{ history.dates|tojson }};
      const data = {{ history.prices|tojson }};
      new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ label: 'Price (₹)', data, tension: 0.2 }]},
        options: { scales: { y: { beginAtZero: false } } }
      });
    </script>
    {% else %}
      <div class="alert alert-info">Select a product to view its history.</div>
    {% endif %}
  </div>
</div>
{% endblock %}